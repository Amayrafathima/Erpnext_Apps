import{G as C,h as S,j as V,e as u,J as A,o as p,c as i,w as d,b as k,u as l,x as R,Q as b,R as w}from"./index-a4ebe9d4.js";import E from"./FormView-73b2e90b.js";import{g as j}from"./workflow-91dd932b.js";import"./Badge.vue_vue_type_script_setup_true_lang-c7a62ffe.js";import"./ErrorMessage-12ee4fcd.js";import"./FormField-9f64adb7.js";import"./FileUploaderView-a3ca4199.js";import"./WorkflowActionSheet-b6437bf3.js";import"./formatters-c8b2d612.js";const U={__name:"Form",props:{id:{type:String,required:!1}},setup(y){const s=y,r=C("$employee"),a=S({employee:r.data.name,employee_name:r.data.employee_name,company:r.data.company,department:r.data.department}),c=V(()=>j(a.value.company)),o=u({url:"hrms.api.get_doctype_fields",params:{doctype:"Employee Advance"},transform(e){const n=g(e);return h(n)},onSuccess(e){_.reload(),v.reload()}});o.reload();const _=u({url:"hrms.payroll.doctype.salary_structure_assignment.salary_structure_assignment.get_employee_currency",params:{employee:r.data.name},onSuccess(e){a.value.currency=e,m()}}),f=u({url:"erpnext.setup.utils.get_exchange_rate",onSuccess(e){a.value.exchange_rate=e}}),v=u({url:"hrms.api.get_advance_account",params:{company:a.value.company},onSuccess(e){a.value.advance_account=e}});A(()=>a.value.currency,()=>m());function g(e){const n=["naming_series"],t=["employee","employee_name","department","company","more_info_section","pending_amount"];return s.id||n.push(...t),e.filter(F=>!n.includes(F.fieldname))}function h(e){return e.map(n=>{if(n.fieldname==="advance_account"){let t=[a.value.currency];a.value.currency!=c.value&&t.push(c.value),n.linkFilters={company:a.value.company,is_group:0,root_type:"Asset",account_currency:t}}return n})}function m(){var n;if(!a.value.currency)return;const e=(n=o.data)==null?void 0:n.find(t=>t.fieldname==="exchange_rate");a.value.currency===c.value?(a.value.exchange_rate=1,e.hidden=1):(f.fetch({from_currency:a.value.currency,to_currency:c.value}),e.hidden=0)}function x(){}return(e,n)=>(p(),i(l(w),null,{default:d(()=>[k(l(b),{fullscreen:!0},{default:d(()=>[l(o).data?(p(),i(E,{key:0,doctype:"Employee Advance",modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value=t),isSubmittable:!0,fields:l(o).data,id:s.id,onValidateForm:x},null,8,["modelValue","fields","id"])):R("",!0)]),_:1})]),_:1}))}};export{U as default};
