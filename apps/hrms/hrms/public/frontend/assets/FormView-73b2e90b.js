var lt=Object.defineProperty;var le=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var Me=(t,o,e)=>o in t?lt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,J=(t,o)=>{for(var e in o||(o={}))Re.call(o,e)&&Me(t,e,o[e]);if(le)for(var e of le(o))Pe.call(o,e)&&Me(t,e,o[e]);return t};var oe=(t,o)=>{var e={};for(var r in t)Re.call(t,r)&&o.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&le)for(var r of le(t))o.indexOf(r)<0&&Pe.call(t,r)&&(e[r]=t[r]);return e};var E=(t,o,e)=>new Promise((r,a)=>{var i=m=>{try{w(e.next(m))}catch(v){a(v)}},f=m=>{try{w(e.throw(m))}catch(v){a(v)}},w=m=>m.done?r(m.value):Promise.resolve(m.value).then(i,f);w((e=e.apply(t,o)).next())});import{h as I,aF as M,a6 as re,aG as ot,j as V,aH as nt,aI as st,aJ as rt,aK as it,aL as ut,aM as ne,aN as ie,aO as ge,aP as dt,aQ as ct,aR as mt,aS as Ve,l as We,aT as ft,aD as pt,aU as K,aV as vt,G as yt,aW as gt,aX as T,aY as S,aZ as bt,a_ as $e,a$ as He,b0 as ht,_ as wt,W as xt,p as Ke,$ as kt,r as N,o as y,c as A,w as k,b as C,P as ye,a0 as _t,aE as Be,d as R,t as P,s as se,n as D,F as U,q as Q,x as H,v as Ee,a as F,e as X,A as q,g as Ft,J as Ae,H as It,i as Dt,u as b,y as O,b1 as Ct,b2 as St,aB as Te,Z as pe}from"./index-a4ebe9d4.js";import{_ as Oe}from"./Badge.vue_vue_type_script_setup_true_lang-c7a62ffe.js";import{E as Mt}from"./ErrorMessage-12ee4fcd.js";import Le from"./FormField-9f64adb7.js";import Ne from"./FileUploaderView-a3ca4199.js";import{W as Rt}from"./WorkflowActionSheet-b6437bf3.js";import{u as Pt,g as Vt}from"./workflow-91dd932b.js";import{f as Ue}from"./formatters-c8b2d612.js";let qe=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function je(t){var o,e;let r=(o=t.innerText)!=null?o:"",a=t.cloneNode(!0);if(!(a instanceof HTMLElement))return r;let i=!1;for(let w of a.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))w.remove(),i=!0;let f=i?(e=a.innerText)!=null?e:"":r;return qe.test(f)&&(f=f.replace(qe,"")),f}function $t(t){let o=t.getAttribute("aria-label");if(typeof o=="string")return o.trim();let e=t.getAttribute("aria-labelledby");if(e){let r=e.split(" ").map(a=>{let i=document.getElementById(a);if(i){let f=i.getAttribute("aria-label");return typeof f=="string"?f.trim():je(i).trim()}return null}).filter(Boolean);if(r.length>0)return r.join(", ")}return je(t).trim()}function Bt(t){let o=I(""),e=I("");return()=>{let r=M(t);if(!r)return"";let a=r.innerText;if(o.value===a)return e.value;let i=$t(r).trim().toLowerCase();return o.value=a,e.value=i,i}}var Et=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Et||{}),At=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(At||{});function Tt(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let Ye=Symbol("MenuContext");function ue(t){let o=yt(Ye,null);if(o===null){let e=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,ue),e}return o}let Ot=re({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(t,{slots:o,attrs:e}){let r=I(1),a=I(null),i=I(null),f=I([]),w=I(""),m=I(null),v=I(1);function n(p=g=>g){let g=m.value!==null?f.value[m.value]:null,c=ht(p(f.value.slice()),x=>M(x.dataRef.domRef)),l=g?c.indexOf(g):null;return l===-1&&(l=null),{items:c,activeItemIndex:l}}let h={menuState:r,buttonRef:a,itemsRef:i,items:f,searchQuery:w,activeItemIndex:m,activationTrigger:v,closeMenu:()=>{r.value=1,m.value=null},openMenu:()=>r.value=0,goToItem(p,g,c){let l=n(),x=gt(p===T.Specific?{focus:T.Specific,id:g}:{focus:p},{resolveItems:()=>l.items,resolveActiveIndex:()=>l.activeItemIndex,resolveId:j=>j.id,resolveDisabled:j=>j.dataRef.disabled});w.value="",m.value=x,v.value=c!=null?c:1,f.value=l.items},search(p){let g=w.value!==""?0:1;w.value+=p.toLowerCase();let c=(m.value!==null?f.value.slice(m.value+g).concat(f.value.slice(0,m.value+g)):f.value).find(x=>x.dataRef.textValue.startsWith(w.value)&&!x.dataRef.disabled),l=c?f.value.indexOf(c):-1;l===-1||l===m.value||(m.value=l,v.value=1)},clearSearch(){w.value=""},registerItem(p,g){let c=n(l=>[...l,{id:p,dataRef:g}]);f.value=c.items,m.value=c.activeItemIndex,v.value=1},unregisterItem(p){let g=n(c=>{let l=c.findIndex(x=>x.id===p);return l!==-1&&c.splice(l,1),c});f.value=g.items,m.value=g.activeItemIndex,v.value=1}};return ot([a,i],(p,g)=>{var c;h.closeMenu(),nt(g,st.Loose)||(p.preventDefault(),(c=M(a))==null||c.focus())},V(()=>r.value===0)),rt(Ye,h),it(V(()=>ut(r.value,{0:ne.Open,1:ne.Closed}))),()=>{let p={open:r.value===0,close:h.closeMenu};return ie({ourProps:{},theirProps:t,slot:p,slots:o,attrs:e,name:"Menu"})}}}),Lt=re({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-menu-button-${ge()}`}},setup(t,{attrs:o,slots:e,expose:r}){let a=ue("MenuButton");r({el:a.buttonRef,$el:a.buttonRef});function i(v){switch(v.key){case S.Space:case S.Enter:case S.ArrowDown:v.preventDefault(),v.stopPropagation(),a.openMenu(),K(()=>{var n;(n=M(a.itemsRef))==null||n.focus({preventScroll:!0}),a.goToItem(T.First)});break;case S.ArrowUp:v.preventDefault(),v.stopPropagation(),a.openMenu(),K(()=>{var n;(n=M(a.itemsRef))==null||n.focus({preventScroll:!0}),a.goToItem(T.Last)});break}}function f(v){switch(v.key){case S.Space:v.preventDefault();break}}function w(v){t.disabled||(a.menuState.value===0?(a.closeMenu(),K(()=>{var n;return(n=M(a.buttonRef))==null?void 0:n.focus({preventScroll:!0})})):(v.preventDefault(),a.openMenu(),Tt(()=>{var n;return(n=M(a.itemsRef))==null?void 0:n.focus({preventScroll:!0})})))}let m=dt(V(()=>({as:t.as,type:o.type})),a.buttonRef);return()=>{var v;let n={open:a.menuState.value===0},c=t,{id:h}=c,p=oe(c,["id"]),g={ref:a.buttonRef,id:h,type:m.value,"aria-haspopup":"menu","aria-controls":(v=M(a.itemsRef))==null?void 0:v.id,"aria-expanded":a.menuState.value===0,onKeydown:i,onKeyup:f,onClick:w};return ie({ourProps:g,theirProps:p,slot:n,attrs:o,slots:e,name:"MenuButton"})}}}),Nt=re({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-menu-items-${ge()}`}},setup(t,{attrs:o,slots:e,expose:r}){let a=ue("MenuItems"),i=I(null);r({el:a.itemsRef,$el:a.itemsRef}),ct({container:V(()=>M(a.itemsRef)),enabled:V(()=>a.menuState.value===0),accept(n){return n.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:n.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(n){n.setAttribute("role","none")}});function f(n){var h;switch(i.value&&clearTimeout(i.value),n.key){case S.Space:if(a.searchQuery.value!=="")return n.preventDefault(),n.stopPropagation(),a.search(n.key);case S.Enter:if(n.preventDefault(),n.stopPropagation(),a.activeItemIndex.value!==null){let p=a.items.value[a.activeItemIndex.value];(h=M(p.dataRef.domRef))==null||h.click()}a.closeMenu(),He(M(a.buttonRef));break;case S.ArrowDown:return n.preventDefault(),n.stopPropagation(),a.goToItem(T.Next);case S.ArrowUp:return n.preventDefault(),n.stopPropagation(),a.goToItem(T.Previous);case S.Home:case S.PageUp:return n.preventDefault(),n.stopPropagation(),a.goToItem(T.First);case S.End:case S.PageDown:return n.preventDefault(),n.stopPropagation(),a.goToItem(T.Last);case S.Escape:n.preventDefault(),n.stopPropagation(),a.closeMenu(),K(()=>{var p;return(p=M(a.buttonRef))==null?void 0:p.focus({preventScroll:!0})});break;case S.Tab:n.preventDefault(),n.stopPropagation(),a.closeMenu(),K(()=>bt(M(a.buttonRef),n.shiftKey?$e.Previous:$e.Next));break;default:n.key.length===1&&(a.search(n.key),i.value=setTimeout(()=>a.clearSearch(),350));break}}function w(n){switch(n.key){case S.Space:n.preventDefault();break}}let m=mt(),v=V(()=>m!==null?(m.value&ne.Open)===ne.Open:a.menuState.value===0);return()=>{var n,h;let p={open:a.menuState.value===0},x=t,{id:g}=x,c=oe(x,["id"]),l={"aria-activedescendant":a.activeItemIndex.value===null||(n=a.items.value[a.activeItemIndex.value])==null?void 0:n.id,"aria-labelledby":(h=M(a.buttonRef))==null?void 0:h.id,id:g,onKeydown:f,onKeyup:w,role:"menu",tabIndex:0,ref:a.itemsRef};return ie({ourProps:l,theirProps:c,slot:p,attrs:o,slots:e,features:Ve.RenderStrategy|Ve.Static,visible:v.value,name:"MenuItems"})}}}),Ut=re({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-menu-item-${ge()}`}},setup(t,{slots:o,attrs:e,expose:r}){let a=ue("MenuItem"),i=I(null);r({el:i,$el:i});let f=V(()=>a.activeItemIndex.value!==null?a.items.value[a.activeItemIndex.value].id===t.id:!1),w=Bt(i),m=V(()=>({disabled:t.disabled,get textValue(){return w()},domRef:i}));We(()=>a.registerItem(t.id,m)),ft(()=>a.unregisterItem(t.id)),pt(()=>{a.menuState.value===0&&f.value&&a.activationTrigger.value!==0&&K(()=>{var l,x;return(x=(l=M(i))==null?void 0:l.scrollIntoView)==null?void 0:x.call(l,{block:"nearest"})})});function v(l){if(t.disabled)return l.preventDefault();a.closeMenu(),He(M(a.buttonRef))}function n(){if(t.disabled)return a.goToItem(T.Nothing);a.goToItem(T.Specific,t.id)}let h=vt();function p(l){h.update(l)}function g(l){h.wasMoved(l)&&(t.disabled||f.value||a.goToItem(T.Specific,t.id,0))}function c(l){h.wasMoved(l)&&(t.disabled||f.value&&a.goToItem(T.Nothing))}return()=>{let{disabled:l}=t,x={active:f.value,disabled:l,close:a.closeMenu},Z=t,{id:j}=Z,ee=oe(Z,["id"]);return ie({ourProps:{id:j,ref:i,role:"menuitem",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,disabled:void 0,onClick:v,onFocus:n,onPointerenter:p,onMouseenter:p,onPointermove:g,onMousemove:g,onPointerleave:c,onMouseleave:c},theirProps:J(J({},e),ee),slot:x,attrs:e,slots:o,name:"MenuItem"})}}});const qt={name:"Dropdown",props:{button:{type:Object,default:null},options:{type:Array,default:()=>[]},placement:{type:String,default:"left"}},components:{Menu:Ot,MenuButton:Lt,MenuItems:Nt,MenuItem:Ut,Button:xt,FeatherIcon:Ke,Popover:kt},methods:{normalizeDropdownItem(t){let o=t.onClick||null;return!o&&t.route&&this.$router&&(o=()=>this.$router.push(t.route)),{label:t.label,icon:t.icon,group:t.group,component:t.component,onClick:o}},filterOptions(t){return(t||[]).filter(Boolean).filter(o=>o.condition?o.condition():!0).map(o=>this.normalizeDropdownItem(o))}},computed:{groups(){var o;return((o=this.options[0])!=null&&o.group?this.options:[{group:"",items:this.options}]).map((e,r)=>({key:r,group:e.group,hideLabel:e.hideLabel||!1,items:this.filterOptions(e.items)}))},dropdownTransition(){return{enterActiveClass:"transition duration-100 ease-out",enterFromClass:"transform scale-95 opacity-0",enterToClass:"transform scale-100 opacity-100",leaveActiveClass:"transition duration-75 ease-in",leaveFromClass:"transform scale-100 opacity-100",leaveToClass:"transform scale-95 opacity-0"}},popoverPlacement(){return this.placement==="left"?"bottom-start":this.placement==="right"?"bottom-end":this.placement==="center"?"bottom-center":"bottom"}}},jt={key:0,class:"flex h-7 items-center px-2 text-sm font-medium text-gray-500"},zt=["onClick"],Wt={class:"whitespace-nowrap"};function Ht(t,o,e,r,a,i){const f=N("Button"),w=N("MenuButton"),m=N("FeatherIcon"),v=N("MenuItem"),n=N("MenuItems"),h=N("Popover"),p=N("Menu");return y(),A(p,{as:"div",class:"relative inline-block text-left"},{default:k(({open:g})=>[C(h,{transition:i.dropdownTransition,show:g,placement:i.popoverPlacement},{target:k(()=>[C(w,{as:"div"},{default:k(()=>[t.$slots.default?ye(t.$slots,"default",_t(Be({key:0},{open:g}))):(y(),A(f,Be({key:1,active:g},e.button),{default:k(()=>{var c;return[R(P(e.button?((c=e.button)==null?void 0:c.label)||null:"Options"),1)]}),_:2},1040,["active"]))]),_:2},1024)]),body:k(()=>[C(n,{class:se(["mt-2 min-w-40 divide-y divide-gray-100 rounded-lg bg-white shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none",{"left-0 origin-top-left":e.placement=="left","right-0 origin-top-right":e.placement=="right","inset-x-0 origin-top":e.placement=="center"}])},{default:k(()=>[(y(!0),D(U,null,Q(i.groups,c=>(y(),D("div",{key:c.key,class:"p-1.5"},[c.group&&!c.hideLabel?(y(),D("div",jt,P(c.group),1)):H("",!0),(y(!0),D(U,null,Q(c.items,l=>(y(),A(v,{key:l.label},{default:k(({active:x})=>[l.component?(y(),A(Ee(l.component),{key:0,active:x},null,8,["active"])):(y(),D("button",{key:1,class:se([x?"bg-gray-100":"text-gray-800","group flex h-7 w-full items-center rounded px-2 text-base"]),onClick:l.onClick},[l.icon&&typeof l.icon=="string"?(y(),A(m,{key:0,name:l.icon,class:"mr-2 h-4 w-4 flex-shrink-0 text-gray-700","aria-hidden":"true"},null,8,["name"])):l.icon?(y(),A(Ee(l.icon),{key:1,class:"mr-2 h-4 w-4 flex-shrink-0 text-gray-700"})):H("",!0),F("span",Wt,P(l.label),1)],10,zt))]),_:2},1024))),128))]))),128))]),_:1},8,["class"])]),_:2},1032,["transition","show","placement"])]),_:3})}const Kt=wt(qt,[["render",Ht]]);function Yt(){const t=new FileReader;return t.__zone_symbol__originalInstance||t}class ze{constructor(o){this.fileObj=o,this.fileName=o.name}upload(o,e,r){return E(this,null,function*(){return new Promise((a,i)=>E(this,null,function*(){const f=Yt(),w=X({url:"hrms.api.upload_base64_file",onSuccess:m=>a(m),onError:m=>{var v;q({title:"Error",text:`File upload failed for ${this.fileName}. ${((v=m.messages)==null?void 0:v[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),i(m)}});f.onload=()=>{console.log("Loaded successfully ✅"),this.fileContents=f.result.toString().split(",")[1],w.submit({content:this.fileContents,dt:o,dn:e,filename:this.fileName,fieldname:r})},f.readAsDataURL(this.fileObj)}))})}delete(){return X({url:"hrms.api.delete_attachment",onSuccess:()=>{console.log("Deleted successfully ✅")},onError:o=>{var e;q({title:"Error",text:`File deletion failed. ${((e=o.messages)==null?void 0:e[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}}).submit({filename:this.fileName})}}const ve=(t,o)=>t.some(e=>o.includes(e));function Jt(t,o){return E(this,null,function*(){var i;const r=yield X({url:"hrms.api.get_doctype_states",params:{doctype:t}}).reload();if((i=Object.keys(r||{}))!=null&&i.length){if((r==null?void 0:r[o])==="yellow")return"orange";if(r!=null&&r[o])return r==null?void 0:r[o]}let a="gray";return o=o.toLowerCase(),ve(["open","pending","unpaid","review","medium","not approved"],o)?a="orange":ve(["urgent","high","failed","rejected","error"],o)?a="red":ve(["closed","finished","converted","completed","complete","confirmed","approved","yes","active","available","success"],o)?a="green":o==="submitted"&&(a="blue"),a})}const Qt={key:0,class:"flex flex-col h-full w-full"},Zt={class:"w-full h-full bg-white sm:w-96 flex flex-col relative overflow-y-auto"},Gt={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center border-b sticky top-0 z-[1000]"},Xt={key:0,class:"flex flex-row items-center gap-2 overflow-hidden grow"},ea={class:"text-xl font-semibold text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis"},ta={key:1,class:"text-2xl font-semibold text-gray-900"},aa={class:"bg-white grow"},la={class:"px-4 sticky top-15 z-[100] bg-white text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700"},oa={class:"flex -mb-px overflow-auto hide-scrollbar"},na={class:"mr-2 whitespace-nowrap"},sa=["onClick"],ra={class:"flex flex-col space-y-4 p-4"},ia={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},ua=F("span",{class:"text-gray-900 text-sm"},"Uploading...",-1),da={key:1,class:"flex flex-col space-y-4 p-4"},ca={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},ma=F("span",{class:"text-gray-900 text-sm"},"Uploading...",-1),fa={key:0,class:"px-4 pt-4 mt-2 sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg pb-10"},pa={key:2,class:"px-4 pt-4 mt-2 sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg pb-10"},va={class:"text-xl font-bold"},ya={class:"font-bold"},ga={class:"flex flex-row gap-4"},ba=F("h2",{class:"text-xl font-bold"},"Confirm",-1),ha={class:"font-bold"},wa={class:"flex flex-row gap-4"},xa=F("h2",{class:"text-xl font-bold"},"Confirm",-1),ka={class:"font-bold"},_a={class:"flex flex-row gap-4"},$a={__name:"FormView",props:{doctype:{type:String,required:!0},modelValue:{type:Object,required:!0},isSubmittable:{type:Boolean,required:!1,default:!1},fields:{type:Array,required:!0},id:{type:String,required:!1},tabbedView:{type:Boolean,required:!1,default:!1},tabs:{type:Array,required:!1},showAttachmentView:{type:Boolean,required:!1,default:!1},showFormButton:{type:Boolean,required:!1,default:!0}},emits:["validateForm","update:modelValue"],setup(t,{emit:o}){var Fe;const e=t,r=Ft();let a=I((Fe=e.tabs)==null?void 0:Fe[0].name),i=I([]),f=I(""),w=I(""),m=I(!1),v=I(!1),n=I(!1),h=I(!1),p=I(!1),g=I(!1),c=I(null);const l=V({get(){return e.modelValue},set(u){o("update:modelValue",u)}}),x=V(()=>{if(!e.id)return"";if(c.value){const u=c.value.getWorkflowStateField();if(u)return l.value[u]}return l.value.status||l.value.approval_status});Ae(()=>l.value,()=>{e.id&&(fe.value&&!v.value?m.value=!0:v.value&&(v.value=!1))},{deep:!0}),Ae(()=>x.value,u=>E(this,null,function*(){u&&(f.value=yield Jt(e.doctype,x.value))}),{immediate:!0});const j=V(()=>{var z;let u={},s=[],B=0,L=0;return(z=e.tabs)==null||z.forEach(Y=>{L=e.fields.findIndex(W=>W.fieldname===Y.lastField),s=e.fields.slice(B,L+1),u[Y.name]=s,B=L+1}),u}),ee=X({url:"hrms.api.get_attachments",params:{dt:e.doctype,dn:e.id},transform(u){return u.map(s=>s.uploaded=!0)},onSuccess(u){i.value=u}}),Z=u=>{e.id?he(e.doctype,e.id,[...u.target.files]):i.value.push(...u.target.files)},be=u=>E(this,null,function*(){u.uploaded?(yield new ze(u).delete(),yield ee.reload()):i.value=i.value.filter(s=>s.name!==u.name)});function he(u,s,B){return E(this,null,function*(){g.value=!0;const L=B.map(z=>new ze(z).upload(u,s,"").then(W=>{W.uploaded=!0,e.id&&i.value.push(W)}));yield Promise.allSettled(L),g.value=!1})}const de=It({doctype:e.doctype,insert:{onSuccess(u){return E(this,null,function*(){q({title:"Success",text:`${e.doctype} created successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"}),yield he(u.doctype,u.name,i.value),r.replace({name:`${e.doctype.replace(/\s+/g,"")}DetailView`,params:{id:u.name}})})},onError(){q({title:"Error",text:`Error creating ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error creating ${e.doctype}`)}}}),$=Dt({doctype:e.doctype,name:e.id,fields:"*",setValue:{onSuccess(){q({title:"Success",text:`${e.doctype} updated successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){q({title:"Error",text:`Error updating ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error updating ${e.doctype}`)}},delete:{onSuccess(){r.back(),q({title:"Success",text:`${e.doctype} deleted successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){q({title:"Error",text:`Error deleting ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error deleting ${e.doctype}`)}}}),we=X({url:"frappe.client.get_doc_permissions"}),G=V(()=>{if(e.showFormButton){if(e.id&&e.isSubmittable&&!m.value){if(l.value.docstatus===0&&ce("submit"))return"Submit";if(l.value.docstatus===1&&ce("cancel"))return"Cancel"}else if(l.value.docstatus!==2)return"Save"}});function Je(){return e.id&&l.value.docstatus!==1&&ce("delete")}function ce(u){var s;return(s=we.data)==null?void 0:s.permissions[u]}function Qe(){xe()&&de.insert.submit(l.value)}function xe(){const u=e.fields.filter(s=>s.reqd&&!s.hidden&&!l.value[s.fieldname]).map(s=>s.label);return u.length?(w.value=`${u.join(", ")} ${u.length>1?"fields are mandatory":"field is mandatory"}`,!1):(w.value="",!0)}function me(u){return E(this,null,function*(){if($.doc){let s=J({},l.value);if(!xe())return;u=="submit"?s.docstatus=1:u=="cancel"&&(s.docstatus=2),yield $.setValue.submit(s),yield $.get.promise,_e()}u==="submit"?h.value=!1:u==="cancel"&&(p.value=!1)})}function Ze(){o("validateForm"),e.id?me():Qe()}function Ge(){m.value||(l.value.docstatus===0?(o("validateForm"),h.value=!0):l.value.docstatus===1&&(p.value=!0))}function Xe(){$.delete.submit(),n.value=!1}function ke(){return E(this,null,function*(){yield $.reload(),_e()})}function _e(){l.value=J({},$.doc),K(()=>{m.value=!1,v.value=!0})}function et(){return E(this,null,function*(){const u=yield Vt(l.value.company);e.fields.forEach(s=>{s.fieldtype==="Currency"&&(s.readOnly||te.value)&&(s.options==="currency"?l.value[s.fieldname]=Ue(l.value[s.fieldname],l.value.currency):l.value[s.fieldname]=Ue(l.value[s.fieldname],u))})})}const te=V(()=>{var u;if(!fe.value)return!0;if(!e.id)return!1;if(l.value.docstatus!==0||(u=c.value)!=null&&u.isReadOnly(l.value))return!0}),fe=V(()=>e.id?!$.get.loading&&$.doc:!0);return We(()=>E(this,null,function*(){e.id&&(yield $.get.promise,l.value=J({},$.doc),yield we.fetch({doctype:e.doctype,docname:e.id}),yield ee.reload(),yield et(),c.value=Pt(e.doctype),m.value=!1)})),(u,s)=>{var L,z,Y,W,Ie,De,Ce,Se;const B=N("Button");return y(),D(U,null,[fe.value?(y(),D("div",Qt,[F("div",Zt,[F("header",Gt,[C(B,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:s[0]||(s[0]=d=>b(r).back())},{default:k(()=>[C(b(Ke),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),t.id?(y(),D("div",Xt,[F("h2",ea,P(t.doctype),1),C(b(Oe),{label:t.id,class:"whitespace-nowrap text-[8px]",variant:"outline"},null,8,["label"]),x.value?(y(),A(b(Oe),{key:0,label:x.value,theme:b(f),class:"whitespace-nowrap text-[8px]"},null,8,["label","theme"])):H("",!0),C(b(Kt),{class:"ml-auto",options:[{label:"Delete",condition:Je,onClick:()=>O(n)?n.value=!0:n=!0},{label:"Reload",onClick:()=>ke()}],button:{label:"Menu",icon:"more-horizontal",variant:"ghost"}},null,8,["options"])])):(y(),D("h2",ta,P(`New ${t.doctype}`),1))]),F("div",aa,[F("div",la,[F("ul",oa,[(y(!0),D(U,null,Q(t.tabs,d=>(y(),D("li",na,[F("button",{onClick:ae=>O(a)?a.value=d.name:a=d.name,class:se(["inline-block p-4 border-b-2 border-transparent rounded-t-lg",[b(a)===d.name?"!text-gray-800 !border-gray-800":"hover:text-gray-600 hover:border-gray-300"]])},P(d.name),11,sa)]))),256))])]),t.tabbedView?(y(!0),D(U,{key:0},Q(j.value,(d,ae,tt)=>Ct((y(),D("div",ra,[(y(!0),D(U,null,Q(d,_=>(y(),D(U,{key:_.fieldname},[_.fieldtype=="Table"?ye(u.$slots,_.fieldname,{key:0,isFormReadOnly:te.value}):(y(),A(Le,{key:1,fieldtype:_.fieldtype,fieldname:_.fieldname,modelValue:l.value[_.fieldname],"onUpdate:modelValue":at=>l.value[_.fieldname]=at,default:_.default,label:_.label,options:_.options,linkFilters:_.linkFilters,documentList:_.documentList,readOnly:!!_.read_only||te.value,reqd:!!_.reqd,hidden:!!_.hidden,errorMessage:_.error_message,minDate:_.minDate,maxDate:_.maxDate,addSectionPadding:d[0].name!==_.name},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate","addSectionPadding"]))],64))),128)),b(g)?(y(),D("div",ia,[C(b(Te),{class:"w-3 h-3 text-gray-800"}),ua])):t.showAttachmentView&&tt===0?(y(),A(Ne,{key:1,modelValue:b(i),"onUpdate:modelValue":s[1]||(s[1]=_=>O(i)?i.value=_:i=_),onHandleFileSelect:Z,onHandleFileDelete:be},null,8,["modelValue"])):H("",!0)],512)),[[St,ae===b(a)]])),256)):(y(),D("div",da,[(y(!0),D(U,null,Q(e.fields,d=>(y(),A(Le,{key:d.name,fieldtype:d.fieldtype,fieldname:d.fieldname,modelValue:l.value[d.fieldname],"onUpdate:modelValue":ae=>l.value[d.fieldname]=ae,default:d.default,label:d.label,options:d.options,linkFilters:d.linkFilters,documentList:d.documentList,readOnly:!!d.read_only||te.value,reqd:!!d.reqd,hidden:!!d.hidden,errorMessage:d.error_message,minDate:d.minDate,maxDate:d.maxDate},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate"]))),128)),b(g)?(y(),D("div",ca,[C(b(Te),{class:"w-3 h-3 text-gray-800"}),ma])):t.showAttachmentView?(y(),A(Ne,{key:1,modelValue:b(i),"onUpdate:modelValue":s[2]||(s[2]=d=>O(i)?i.value=d:i=d),onHandleFileSelect:Z,onHandleFileDelete:be},null,8,["modelValue"])):H("",!0)]))]),t.showFormButton?!b(m)&&((L=b(c))!=null&&L.hasWorkflow)?(y(),A(Rt,{key:1,doc:b($).doc,workflow:b(c),onWorkflowApplied:s[3]||(s[3]=d=>ke())},null,8,["doc","workflow"])):b(m)||!((z=b(c))!=null&&z.hasWorkflow)&&G.value?(y(),D("div",pa,[C(b(Mt),{class:"mb-2",message:b(w)||((W=(Y=b(de))==null?void 0:Y.insert)==null?void 0:W.error)||((De=(Ie=b($))==null?void 0:Ie.setValue)==null?void 0:De.error)},null,8,["message"]),C(B,{class:se(["w-full rounded mt-2 py-5 text-base disabled:bg-gray-700 disabled:text-white",G.value==="Cancel"?"shadow":""]),onClick:s[4]||(s[4]=d=>G.value==="Save"?Ze():Ge()),variant:G.value==="Cancel"?"subtle":"solid",loading:b(de).insert.loading||((Se=(Ce=b($))==null?void 0:Ce.setValue)==null?void 0:Se.loading)},{default:k(()=>[R(P(G.value),1)]),_:1},8,["class","variant","loading"])])):H("",!0):(y(),D("div",fa,[ye(u.$slots,"formButton")]))])])):H("",!0),C(b(pe),{modelValue:b(n),"onUpdate:modelValue":s[6]||(s[6]=d=>O(n)?n.value=d:n=d)},{"body-title":k(()=>[F("h2",va,"Delete "+P(e.doctype),1)]),"body-content":k(()=>[F("p",null,[R(" Are you sure you want to delete the "+P(e.doctype)+" ",1),F("span",ya,P(l.value.name),1),R(" ? ")])]),actions:k(()=>[F("div",ga,[C(B,{variant:"outline",class:"py-5 w-full",onClick:s[5]||(s[5]=d=>O(n)?n.value=!1:n=!1)},{default:k(()=>[R(" Cancel ")]),_:1}),C(B,{variant:"solid",theme:"red",onClick:Xe,class:"py-5 w-full"},{default:k(()=>[R(" Delete ")]),_:1})])]),_:1},8,["modelValue"]),C(b(pe),{modelValue:b(h),"onUpdate:modelValue":s[9]||(s[9]=d=>O(h)?h.value=d:h=d)},{"body-title":k(()=>[ba]),"body-content":k(()=>[F("p",null,[R(" Permanently submit "+P(e.doctype)+" ",1),F("span",ha,P(l.value.name),1),R(" ? ")])]),actions:k(()=>[F("div",wa,[C(B,{variant:"outline",class:"py-5 w-full",onClick:s[7]||(s[7]=d=>O(h)?h.value=!1:h=!1)},{default:k(()=>[R(" No ")]),_:1}),C(B,{variant:"solid",onClick:s[8]||(s[8]=d=>me("submit")),class:"py-5 w-full"},{default:k(()=>[R(" Yes ")]),_:1})])]),_:1},8,["modelValue"]),C(b(pe),{modelValue:b(p),"onUpdate:modelValue":s[12]||(s[12]=d=>O(p)?p.value=d:p=d)},{"body-title":k(()=>[xa]),"body-content":k(()=>[F("p",null,[R(" Permanently cancel "+P(e.doctype)+" ",1),F("span",ka,P(l.value.name),1),R("? ")])]),actions:k(()=>[F("div",_a,[C(B,{variant:"outline",class:"py-5 w-full",onClick:s[10]||(s[10]=d=>O(p)?p.value=!1:p=!1)},{default:k(()=>[R(" No ")]),_:1}),C(B,{variant:"solid",onClick:s[11]||(s[11]=d=>me("cancel")),class:"py-5 w-full"},{default:k(()=>[R(" Yes ")]),_:1})])]),_:1},8,["modelValue"])],64)}}};export{$a as default};
