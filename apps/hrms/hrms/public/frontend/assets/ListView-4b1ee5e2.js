var oe=Object.defineProperty,se=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var j=(s,e,l)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l,D=(s,e)=>{for(var l in e||(e={}))ae.call(e,l)&&j(s,l,e[l]);if(N)for(var l of N(e))re.call(e,l)&&j(s,l,e[l]);return s},z=(s,e)=>se(s,le(e));var H=(s,e,l)=>new Promise((R,C)=>{var F=n=>{try{p(l.next(n))}catch(u){C(u)}},m=n=>{try{p(l.throw(n))}catch(u){C(u)}},p=n=>n.done?R(n.value):Promise.resolve(n.value).then(F,m);p((l=l.apply(s,e)).next())});import{m as T,g as ne,G as P,a5 as ie,h as w,j as $,e as ue,J as ce,l as fe,r as A,o as h,n as x,b as a,w as d,a as _,u as r,p as U,t as de,s as me,d as pe,O as ve,az as ge,aA as ye,F as M,q as we,c as O,v as he,x as W,aB as _e,Q as be,z as G,aC as ke}from"./index-a4ebe9d4.js";import xe from"./TabButtons-719fe1a3.js";import Ce from"./LeaveRequestItem-6af1d335.js";import Fe from"./ExpenseClaimItem-6d589627.js";import Be from"./EmployeeAdvanceItem-7a62e569.js";import Se from"./ListFiltersActionSheet-f9ad78dc.js";import $e from"./CustomIonModal-fbd62d68.js";import{u as Re}from"./workflow-91dd932b.js";import{u as Ve}from"./realtime-e523faa8.js";import"./Badge.vue_vue_type_script_setup_true_lang-c7a62ffe.js";import"./EmployeeAvatar-7cb223ed.js";import"./Avatar.vue_vue_type_script_setup_true_lang-bcd6ccc1.js";import"./leaves-a1e54b4b.js";import"./formatters-c8b2d612.js";import"./EmployeeAdvanceIcon-613127b5.js";import"./FormField-9f64adb7.js";import"./ErrorMessage-12ee4fcd.js";const qe={class:"w-full sm:w-96"},Te={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},Ae={class:"flex flex-row items-center"},Ee={class:"text-xl font-semibold text-gray-900"},Ie={class:"flex flex-row gap-2"},Le={class:"w-full mt-5"},Ne={key:0,class:"flex flex-col bg-white rounded mt-5"},je={key:2,class:"flex mt-2 items-center justify-center"},st={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!0},pageTitle:{type:String,required:!0}},setup(s){const e=s,l={"Leave Application":T(Ce),"Expense Claim":T(Fe),"Employee Advance":T(Be)},R=ne(),C=P("$socket"),F=P("$employee"),m=ie({}),p=w(e.tabButtons[0]),n=w(!1),u=w([]),B=w(null),E=w(null),V=w(!0),S=w({doctype:e.doctype,fields:e.fields,group_by:e.groupBy,order_by:`\`tab${e.doctype}\`.modified desc`,page_length:50}),I=$(()=>p.value===e.tabButtons[1]),J=$(()=>`${e.doctype.replace(/\s+/g,"")}FormView`),Q=$(()=>`${e.doctype.replace(/\s+/g,"")}DetailView`),K=$(()=>{const t=[];return I.value?t.push([e.doctype,"employee","!=",F.data.name]):t.push([e.doctype,"employee","=",F.data.name]),t}),c=ue({url:"frappe.desk.reportview.get",onSuccess:t=>{var o;((o=t.values)==null?void 0:o.length)<S.value.page_length&&(V.value=!1)},transform(t){if(t.length===0)return[];const o=t.keys,b=t.values.map(y=>{const k={};return o.forEach((i,q)=>{k[i]=y[q]}),k});let g;return!c.params.start||c.params.start===0?g=b:g=c.data.concat(b),g}});function L(){e.filterConfig.forEach(t=>{m[t.fieldname]={condition:"=",value:null}}),u.value=[]}L();function X(){let t="",o="";u.value=[];for(const f in m)t=m[f].condition,typeof t=="object"&&t!==null&&(t=t.value),o=m[f].value,t&&o&&u.value.push([e.doctype,f,t,o])}function Y(){X(),v(),G.dismiss(),n.value=!!u.value.length}function Z(){L(),v(),G.dismiss(),n.value=!1}function v(t=0){t===0&&(V.value=!0);const o=[[e.doctype,"docstatus","!=","2"]];o.push(...K.value),u.value&&o.push(...u.value),B.value&&S.value.fields.push(B.value),c.submit(z(D({},S.value),{start:t||0,filters:o}))}const ee=ke(()=>{if(!V.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:f}=E.value;if(t/(o-f)*100>=90){const g=c.params.start+S.value.page_length;v(g)}},500),te=t=>{setTimeout(()=>{v(),t.target.complete()},500)};return ce(()=>p.value,t=>{v()}),fe(()=>H(this,null,function*(){const t=Re(e.doctype);yield t.workflowDoc.promise,B.value=t.getWorkflowStateField(),v(),Ve(C,e.doctype,()=>v())})),(t,o)=>{const f=A("Button"),b=A("router-link"),g=A("EmptyState");return h(),x(M,null,[a(r(ve),{class:"ion-no-border"},{default:d(()=>[_("div",qe,[_("div",Te,[_("div",Ae,[a(f,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:o[0]||(o[0]=y=>r(R).back())},{default:d(()=>[a(r(U),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),_("h2",Ee,de(s.pageTitle),1)]),_("div",Ie,[a(f,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:me([n.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),a(b,{to:{name:J.value}},{default:d(({navigate:y})=>[a(f,{variant:"solid",class:"mr-2",onClick:y},{prefix:d(()=>[a(r(U),{name:"plus",class:"w-4"})]),default:d(()=>[pe(" New ")]),_:2},1032,["onClick"])]),_:1},8,["to"])])])])]),_:1}),a(r(be),null,{default:d(()=>{var y,k;return[a(r(ge),{slot:"fixed",onIonRefresh:o[1]||(o[1]=i=>te(i))},{default:d(()=>[a(r(ye))]),_:1}),_("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:E,onScroll:o[3]||(o[3]=()=>r(ee)())},[_("div",Le,[a(xe,{buttons:[{label:s.tabButtons[0]},{label:s.tabButtons[1]}],modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=i=>p.value=i)},null,8,["buttons","modelValue"]),!r(c).loading&&((y=r(c).data)!=null&&y.length)?(h(),x("div",Ne,[(h(!0),x(M,null,we(r(c).data,i=>(h(),x("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:i.name},[a(b,{to:{name:Q.value,params:{id:i.name}}},{default:d(({navigate:q})=>[(h(),O(he(l[s.doctype]),{doc:i,isTeamRequest:I.value,workflowStateField:B.value,onClick:q},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"])]))),128))])):r(c).loading?W("",!0):(h(),O(g,{key:1,message:`No ${(k=e.doctype)==null?void 0:k.toLowerCase()}s found`},null,8,["message"])),r(c).loading?(h(),x("div",je,[a(r(_e),{class:"w-8 h-8 text-gray-800"})])):W("",!0)])],544),a($e,{trigger:"show-filter-modal"},{actionSheet:d(()=>[a(Se,{filterConfig:s.filterConfig,onApplyFilters:Y,onClearFilters:Z,filters:m,"onUpdate:filters":o[4]||(o[4]=i=>m=i)},null,8,["filterConfig","filters"])]),_:1})]}),_:1})],64)}}};export{st as default};
