import{G as h,h as T,e as d,J as s,o as D,c as g,w as b,b as Y,u as _,x as j,Q as k,R as q}from"./index-a4ebe9d4.js";import C from"./FormView-73b2e90b.js";import"./Badge.vue_vue_type_script_setup_true_lang-c7a62ffe.js";import"./ErrorMessage-12ee4fcd.js";import"./FormField-9f64adb7.js";import"./FileUploaderView-a3ca4199.js";import"./WorkflowActionSheet-b6437bf3.js";import"./workflow-91dd932b.js";import"./formatters-c8b2d612.js";const U={__name:"Form",props:{id:{type:String,required:!1}},setup(F){const i=F,L=h("$dayjs"),r=h("$employee"),u=L().format("YYYY-MM-DD"),a=T({}),n=d({url:"hrms.api.get_doctype_fields",params:{doctype:"Leave Application"},transform(e){return V(e).map(t=>(t.fieldname==="half_day_date"&&(t.hidden=!0),t.fieldname==="posting_date"&&(t.default=u),t))},onSuccess(e){S.reload(),m.reload()}});n.reload();const S=d({url:"hrms.api.get_leave_approval_details",params:{employee:r.data.name},onSuccess(e){B(e)}}),m=d({url:"hrms.api.get_leave_types",params:{employee:r.data.name,date:u},onSuccess(e){$(e)}});s(()=>a.value.employee,e=>{i.id&&e!==r.data.name&&x()}),s(()=>a.value.leave_type,e=>v()),s(()=>a.value.half_day,e=>f(e)),s(()=>a.value.half_day&&a.value.half_day_date,()=>p()),s(()=>a.value.from_date,e=>{a.value.to_date||(a.value.to_date=e),m.fetch({employee:r.data.name,date:e})}),s(()=>[a.value.from_date,a.value.to_date],([e,l])=>{A(e,l),c(),p()});function V(e){const l=["naming_series","sb_other_details","salary_slip","letter_head"],t=["employee","employee_name","department","company","follow_via_email","status","posting_date"];return i.id||l.push(...t),e.filter(o=>!l.includes(o.fieldname))}function x(){a.value.leave_approver!==r.data.user_id&&n.data.map(e=>e.read_only=!0)}function A(e,l){if(!(e&&l))return;const t=e>l?"To Date cannot be before From Date":"",o=n.data.find(R=>R.fieldname==="from_date");o.error_message=t}function p(){if(!y())return;d({url:"hrms.hr.doctype.leave_application.leave_application.get_number_of_leave_days",params:{employee:r.data.name,leave_type:a.value.leave_type,from_date:a.value.from_date,to_date:a.value.to_date,half_day:a.value.half_day,half_day_date:a.value.half_day_date},onSuccess(l){a.value.total_leave_days=l}}).reload(),v()}function v(){if(!y())return;d({url:"hrms.hr.doctype.leave_application.leave_application.get_leave_balance_on",params:{employee:r.data.name,date:a.value.from_date,to_date:a.value.to_date,leave_type:a.value.leave_type,consider_all_leaves_in_the_allocation_period:1},onSuccess(l){a.value.leave_balance=l}}).reload()}function f(e){const l=n.data.find(t=>t.fieldname==="half_day_date");l.hidden=!e,l.reqd=e,e&&(a.value.from_date===a.value.to_date?a.value.half_day_date=a.value.from_date:c())}function c(){const e=n.data.find(l=>l.fieldname==="half_day_date");e.minDate=a.value.from_date,e.maxDate=a.value.to_date}function B(e){var t;const l=(t=n.data)==null?void 0:t.find(o=>o.fieldname==="leave_approver");l.reqd=e==null?void 0:e.is_mandatory,l.documentList=e==null?void 0:e.department_approvers.map(o=>({label:o.full_name?`${o.name} : ${o.full_name}`:o.name,value:o.name})),a.value.leave_approver=e==null?void 0:e.leave_approver,a.value.leave_approver_name=e==null?void 0:e.leave_approver_name}function $(e){const l=n.data.find(t=>t.fieldname==="leave_type");l.documentList=e==null?void 0:e.map(t=>({label:t,value:t}))}function y(){return a.value.from_date&&a.value.to_date&&a.value.leave_type}function w(){f(a.value.half_day),a.value.employee=r.data.name}return(e,l)=>(D(),g(_(q),null,{default:b(()=>[Y(_(k),{fullscreen:!0},{default:b(()=>[_(n).data?(D(),g(C,{key:0,doctype:"Leave Application",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value=t),isSubmittable:!0,fields:_(n).data,id:i.id,onValidateForm:w},null,8,["modelValue","fields","id"])):j("",!0)]),_:1})]),_:1}))}};export{U as default};
