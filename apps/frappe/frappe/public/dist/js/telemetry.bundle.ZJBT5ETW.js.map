{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/lib/posthog.js", "../../../../../apps/frappe/frappe/public/js/telemetry/index.js"],
  "sourcesContent": ["!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(\".\");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement(\"script\")).type=\"text/javascript\",p.async=!0,p.src=s.api_host+\"/static/array.js\",(r=t.getElementsByTagName(\"script\")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a=\"posthog\",u.people=u.people||[],u.toString=function(t){var e=\"posthog\";return\"posthog\"!==a&&(e+=\".\"+a),t||(e+=\" (stub)\"),e},u.people.toString=function(){return u.toString(1)+\".people (stub)\"},o=\"capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags\".split(\" \"),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);\n", "import \"../lib/posthog.js\";\n\nclass TelemetryManager {\n\tconstructor() {\n\t\tthis.enabled = false;\n\n\t\tthis.project_id = frappe.boot.posthog_project_id;\n\t\tthis.telemetry_host = frappe.boot.posthog_host;\n\t\tthis.site_age = frappe.boot.telemetry_site_age;\n\t\tif (cint(frappe.boot.enable_telemetry) && this.project_id && this.telemetry_host) {\n\t\t\tthis.enabled = true;\n\t\t}\n\t}\n\n\tinitialize() {\n\t\tif (!this.enabled) return;\n\t\tlet disable_decide = !this.should_record_session();\n\t\ttry {\n\t\t\tposthog.init(this.project_id, {\n\t\t\t\tapi_host: this.telemetry_host,\n\t\t\t\tautocapture: false,\n\t\t\t\tcapture_pageview: false,\n\t\t\t\tcapture_pageleave: false,\n\t\t\t\tadvanced_disable_decide: disable_decide,\n\t\t\t});\n\t\t\tposthog.identify(frappe.boot.sitename);\n\t\t\tthis.send_heartbeat();\n\t\t\tthis.register_pageview_handler();\n\t\t} catch (e) {\n\t\t\tconsole.trace(\"Failed to initialize telemetry\", e);\n\t\t\tthis.enabled = false;\n\t\t}\n\t}\n\n\tcapture(event, app, props) {\n\t\tif (!this.enabled) return;\n\t\tposthog.capture(`${app}_${event}`, props);\n\t}\n\n\tdisable() {\n\t\tthis.enabled = false;\n\t}\n\n\tcan_enable() {\n\t\tif (cint(navigator.doNotTrack)) {\n\t\t\treturn false;\n\t\t}\n\t\tlet posthog_available = Boolean(this.telemetry_host && this.project_id);\n\t\tlet sentry_available = Boolean(frappe.boot.sentry_dsn);\n\t\treturn posthog_available || sentry_available;\n\t}\n\n\tsend_heartbeat() {\n\t\tconst KEY = \"ph_last_heartbeat\";\n\t\tconst now = frappe.datetime.system_datetime(true);\n\t\tconst last = localStorage.getItem(KEY);\n\n\t\tif (!last || moment(now).diff(moment(last), \"hours\") > 12) {\n\t\t\tlocalStorage.setItem(KEY, now.toISOString());\n\t\t\tthis.capture(\"heartbeat\", \"frappe\", { frappe_version: frappe.boot?.versions?.frappe });\n\t\t}\n\t}\n\n\tregister_pageview_handler() {\n\t\tif (this.site_age && this.site_age > 6) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.router.on(\"change\", () => {\n\t\t\tposthog.capture(\"$pageview\");\n\t\t});\n\t}\n\n\tshould_record_session() {\n\t\tlet start = frappe.boot.sysdefaults.session_recording_start;\n\t\tif (!start) return;\n\n\t\tlet start_datetime = frappe.datetime.str_to_obj(start);\n\t\tlet now = frappe.datetime.now_datetime();\n\t\t// if user allowed recording only record for first 2 hours, never again.\n\t\treturn frappe.datetime.get_minute_diff(now, start_datetime) < 120;\n\t}\n}\n\nfrappe.telemetry = new TelemetryManager();\nfrappe.telemetry.initialize();\n"],
  "mappings": "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",
  "names": ["t", "e", "o"]
}
